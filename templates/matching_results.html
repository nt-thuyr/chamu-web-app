{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block content %}
    <style>
    nav {
    position: relative;
    z-index: 2; /* .bg-blur より高くする */
    }

    .bg-blur {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: url("{% static 'chamu/city.jpg' %}") no-repeat center center fixed;
        background-size: cover;
        filter: blur(2px);
        z-index: 0;
        opacity: 0.6;
    }
    .content-on-blur {
        position: relative;
        z-index: 1;
    }
</style>
<div class="bg-blur"></div>
<div class="content-on-blur">
    <div class="container mt-5">
        <h1 class="text-center mb-4">{{ target_prefecture.name }}</h1>
        <h2 class="text-center mb-4">{% trans "Matching Municipality Ranking Results" %}</h2>
        <p>{% trans "Based on your preferences, here are the ranked municipalities:" %}</p>

        <div class="card mb-4">
            <div class="card-header">
                {% trans "Your Preferences (priority 1 is highest)" %}
            </div>
            <ul class="list-group list-group-flush">
                {% for item in user_preferences %}
                <li class="list-group-item">
                    <span class="badge bg-primary rounded-pill">{{ item.priority }}</span>
                    {{ item.criteria_name }}
                </li>
                {% endfor %}
            </ul>
        </div>

        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">{% trans "Municipality" %}</th>
                    <th scope="col">{% trans "Matching Percentage" %}</th>
                    <th scope="col">{% trans "Details" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for result in matching_results %}
                    <tr >
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>
                            <a href="{% url 'municipality_details' municipality_id=result.municipality.id %}">
                                {{ result.municipality.name }}
                            </a>
                        </td>
                        <td>
                            <strong>{{ result.percentage }}%</strong>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-info" data-bs-toggle="collapse" data-bs-target="#details-{{ forloop.counter }}" aria-expanded="false" aria-controls="details-{{ forloop.counter }}">{% trans "View Details" %}</button>
                        </td>
                    </tr>
                <tr class="collapse" id="details-{{ forloop.counter }}">
                    <td colspan="4">
                        <div class="p-3 bg-light">
                            <p class="text-muted">
                                {% trans "Note: A score of 1.0 is the best possible index, while 5.0 is the worst. Lower scores are more favorable. " %}
                            </p>
                            <h6>{% trans "Detailed scores by criteria:" %}</h6>
                            <ul class="list-unstyled">
                                {% for detail in result.criteria_details %}
                                    <li>
                                        <strong>{{ detail.criteria_name }} (Priority {{ detail.priority }}):</strong>
                                        {% trans "Municipality score" %}: {{ detail.municipality_score|floatformat:2 }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">{% trans "No results were found." %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}