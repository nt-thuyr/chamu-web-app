{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "About" %} {{ municipality.name }}{% endblock %}

{% block content %}
    <style>
    nav {
    position: relative;
    z-index: 2; 
    }

    .bg-blur {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: url("{% static 'chamu/city.jpg' %}") no-repeat center center fixed;
        background-size: cover;
        filter: blur(2px);
        z-index: 0;
        opacity: 0.6;
    }
    .content-on-blur {
        position: relative;
        z-index: 1;
    }
    .text-muted {
    color: #000000 !important;
    font-size: medium;
    margin-bottom: 20px;
    padding: 4px 8px;
    display: inline-block;
    border-radius: 4px;
}


</style>
<div class="bg-blur"></div>
<div class="content-on-blur">
    <div class="container mt-5">
        <h1 class="text-center mb-4">{{ target_prefecture.name }}</h1>
        <h2 class="text-center mb-4">{% trans "理想的な市区町村ランキング" %}</h2>
        

        <div class="card mb-4">
            <div class="card-header">
                {% trans "あなたが理想としている項目ランキング" %}
            </div>
            <ul class="list-group list-group-flush">
                {% for item in user_preferences %}
                <li class="list-group-item">
                    <span class="badge bg-primary rounded-pill">{{ item.priority }}</span>
                    {{ item.criteria_name }}
                </li>
                {% endfor %}
            </ul>
        </div>
        <p>{% trans "あなたの理想に基づいてランキングされた市区町村は以下の通り：" %}</p>
        <small class="text-muted">
            これらのスコアは {{ country.name }} を選択したユーザーを基にしています。
        </small>

    
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">{% trans "市区町村" %}</th>
                    <th scope="col">{% trans "マッチ度" %}</th>
                    <th scope="col">{% trans "詳細" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for result in matching_results %}
                    <tr >
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>
                            <a href="{% url 'municipality_details' municipality_id=result.municipality.id %}">
                                {{ result.municipality.name }}
                            </a>
                        </td>
                        <td>
                            <strong>{{ result.percentage }}%</strong>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-info" data-bs-toggle="collapse" data-bs-target="#details-{{ forloop.counter }}" aria-expanded="false" aria-controls="details-{{ forloop.counter }}">{% trans "詳細を見る" %}</button>
                        </td>
                    </tr>
                <tr class="collapse" id="details-{{ forloop.counter }}">
                    <td colspan="4">
                        <div class="p-3 bg-light">
                            <p class="text-muted">
                                {% trans "注：1.0は高得点、5.0は低得点" %}
                            </p>
                            <h6>{% trans "項目別の詳細スコア" %}</h6>
                            <ul class="list-unstyled">
                                {% for detail in result.criteria_details %}
                                    <li>
                                        <strong>{{ detail.criteria_name }} (マッチ度 {{ detail.priority }}):</strong>
                                        {% trans "市区町村スコア" %}: {{ detail.municipality_score|floatformat:2 }}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">{% trans "No results were found." %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}